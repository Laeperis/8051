# 温湿度/频率监控系统

## 项目结构

```
33组/
├── 8051/                          # 8051单片机项目
│   ├── test/test/                 # 主要代码目录
│   │   ├── main.c                 # 主程序文件
│   │   ├── dht11.c               # DHT11温湿度传感器驱动
│   │   ├── dht11.h               # DHT11头文件
│   │   ├── lcd1602.c             # LCD1602显示屏驱动
│   │   ├── lcd1602.h             # LCD1602头文件
│   │   ├── upper_com_qt.py       # 上位机Qt界面程序
│   │   ├── requirements.txt       # Python依赖包列表
│   │   └── bg.jpg                # 背景图片
│   ├── 8051/                     # Proteus仿真文件
│   │   ├── 新工程.pdsprj         # Proteus项目文件
│   │   └── 新工程.BMP            # 仿真电路图
│   ├── Objects/                   # 编译输出文件
│   │   └── at89c51.hex           # 烧录文件
│   └── at89c51.uvproj            # Keil项目文件
├── Virtual Serial Port Driver 8.0/ # 虚拟串口驱动
│   └── vspdconfig.exe            # 虚拟串口配置工具
├── 33组.pdf                       # 实践报告
├── 33组运行过程视频.mp4           # 运行演示视频
└── README.md                      # 项目说明文档
```

## 快速开始

### 使用步骤

1. **仿真环境准备**
    - 打开Virtual Serial Port Driver 8.0/vspdconfig.exe,配置虚拟端口com1，com2
    - 默认下位机使用com1，上位机使用com2（可以通过COMPIM,上位机界面修改）
   - 打开Proteus仿真文件（8051/8051/新工程.pdsprj）
   - 加载编译生成的hex文件到AT89C51（已设置默认值）

2. **启动系统**
   - 启动Proteus仿真
   - 运行上位机程序(8051/test/test/upper_com_qt.py)

3. **配置参数**
   - 选择正确的串口号（已设置默认值：下位机com1，上位机com2）
   - 选择采集通道（温湿度/频率）
   - 设置报警阈值（已设置默认值）

4. **开始采集**
   - 点击"打开串口"
   - 点击"启动采集"
   - 观察实时数据和图表
   - 在Proteus中观察硬件仿真效果
   - 点击“发送数据”，访问http://data.cancanjiao.xyz 查看远程监控端

### 上位机安装和运行

1. **安装Python依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **运行程序**
   ```bash
   python upper_com_qt.py（在8051/test/test下）
   ```

### 下位机编译和仿真

1. **环境要求**
   - Keil uVision 5
   - 8051编译器
   - Proteus 8 Professional

2. **编译步骤**
   ```
   1. 打开 at89c51.uvproj 项目文件
   2. 编译项目生成 hex 文件(有已经生成好的文件，在8051/Object文件夹下)
   3. 在Proteus中加载hex文件进行仿真
   ```

3. **仿真步骤**
   ```
   1. 打开 8051/新工程.pdsprj 仿真文件
   2. 将编译生成的hex文件加载到AT89C51
   3. 启动仿真
   4. 运行上位机程序进行通信测试
   ```


## 项目概述

这是一个基于8051单片机的温湿度/频率监控系统，包含下位机（8051单片机）和上位机（Python Qt界面）两部分。系统能够实时采集温湿度数据和频率数据，并通过串口与上位机通信，支持数据可视化显示和网络数据上传。


## 硬件组成

### 仿真硬件配置
- **主控芯片**: AT89C51单片机
- **温湿度传感器**: DHT11
- **显示屏**: LCD1602
- **DAC转换器**: PCF8591
- **频率测量**: 555定时器电路
- **报警指示**: LED指示灯（温度、湿度、频率报警）
- **通信接口**: 串口通信
- **仿真环境**: Proteus 8 Professional

### 引脚连接
- **DHT11**: P3.3
- **LCD1602**: P0（数据）, P2.0（RS）, P2.1（RW）, P2.2（E）
- **PCF8591**: P1.0（SCL）, P1.1（SDA）
- **频率输入**: P3.2
- **报警LED**: P1.2（温度）, P1.3（湿度）, P1.4（频率）

### 仿真文件
- **Proteus项目**: `8051/新工程.pdsprj`
- **仿真电路图**: `8051/新工程.BMP`
- **编译文件**: `Objects/at89c51.hex`

## 软件功能

### 下位机功能（8051）

#### 主要特性
1. **双通道数据采集**
   - 通道A：DHT11温湿度传感器
   - 通道B：555频率测量

2. **实时数据显示**
   - LCD1602显示当前采集数据
   - 串口输出数据到上位机

3. **DAC输出**
   - 通过PCF8591将数据转换为模拟信号输出
   - 支持温湿度和频率数据的DAC输出

4. **报警功能**
   - 三个LED指示灯对应不同报警类型
   - 支持温度、湿度、频率报警

5. **数据校验**
   - 实现校验和机制确保数据传输可靠性
   - 支持数据完整性验证

#### 通信协议
- **波特率**: 9600
- **命令格式**: `CMD:X`（X为命令字符）
- **数据格式**: `T:XX H:YY CHECKSUM:ZZ` 或 `FREQ:XXXXX CHECKSUM:ZZ`

#### 支持的命令
- `CMD:S` - 启动采集
- `CMD:E` - 停止采集
- `CMD:A` - 切换到温湿度通道
- `CMD:B` - 切换到频率通道
- `CMD:X/x` - 温度报警开/关
- `CMD:Y/y` - 湿度报警开/关
- `CMD:Z/z` - 频率报警开/关

### 上位机功能（Python Qt）

#### 主要特性
1. **图形化界面**
   - 现代化Qt界面设计
   - 实时数据显示
   - 通道切换控制

2. **数据可视化**
   - 实时折线图显示
   - 支持温度、湿度、频率数据曲线
   - 数据历史记录

3. **串口通信**
   - 自动检测可用串口
   - 串口连接状态监控
   - 数据接收和发送

4. **网络功能**
   - 支持数据上传到服务器
   - HTTP POST请求发送数据
   - 网络状态监控

5. **阈值设置**
   - 可设置温度、湿度、频率报警阈值
   - 实时阈值调整
   - 报警状态显示

## 技术特点

### 下位机技术特点
- **中断驱动**: 使用定时器中断和外部中断实现精确采样
- **多任务处理**: 同时处理串口通信、数据采集、显示更新
- **数据校验**: 实现校验和机制确保数据传输可靠性
- **模块化设计**: 传感器驱动、显示驱动、通信模块分离

### 上位机技术特点
- **多线程架构**: 串口通信、网络通信、UI更新分离
- **实时数据处理**: 支持实时数据接收和显示
- **数据可视化**: 使用pyqtgraph实现高性能图表显示
- **网络集成**: 支持HTTP数据上传功能

## 文件说明

### 核心代码文件

#### main.c
- 主程序文件，包含系统初始化和主循环
- 实现串口通信、数据采集、DAC输出功能
- 处理上位机命令和数据校验

#### dht11.c/dht11.h
- DHT11温湿度传感器驱动
- 实现单总线通信协议
- 提供温湿度读取接口

#### lcd1602.c/lcd1602.h
- LCD1602显示屏驱动
- 实现4位数据线通信
- 提供字符串和数字显示功能

#### upper_com_qt.py
- 上位机Qt界面程序
- 实现串口通信、数据可视化、网络功能
- 提供用户友好的图形界面

### 配置文件

#### requirements.txt
```
PyQt5==5.15.9      # Qt界面框架
pyqtgraph==0.13.3   # 图表显示库
pyserial==3.5       # 串口通信库
requests==2.31.0    # HTTP请求库
```

## 注意事项

1. **仿真环境配置**
   - 确保Proteus版本兼容（推荐8.0以上）
   - 检查仿真文件路径正确
   - 确认hex文件已正确加载到单片机

2. **软件配置**
   - 选择正确的串口号（仿真环境通常为COM2或COM3）
   - 确保波特率设置为9600
   - 检查防火墙设置（网络功能）

3. **数据采集**
   - DHT11传感器在仿真中需要预热时间
   - 频率测量需要稳定的信号源
   - 注意数据校验和错误处理

4. **虚拟串口使用**
   - 安装虚拟串口驱动后需要重启系统
   - 配置虚拟串口对时注意COM口冲突
   - 测试时建议使用虚拟串口进行调试

5. **仿真调试**
   - 在Proteus中可以实时观察硬件状态
   - 可以设置断点进行程序调试
   - 支持单步执行和变量监视

## 故障排除

### 常见问题

1. **仿真无法启动**
   - 检查Proteus版本是否兼容
   - 确认仿真文件路径正确
   - 检查hex文件是否正确加载
   - 确认所有组件连接正确

2. **串口无法连接**
   - 检查串口号是否正确（仿真环境通常为COM2或COM3）
   - 确认虚拟串口驱动已正确安装
   - 检查波特率设置
   - 在Proteus中检查串口组件配置

3. **数据采集异常**
   - 在Proteus中检查传感器连接
   - 确认仿真时钟设置正确
   - 查看串口调试信息
   - 检查仿真中的电源配置

4. **上位机启动失败**
   - 确认Python环境正确
   - 检查依赖包安装
   - 查看错误日志

5. **虚拟串口问题**
   - 确认驱动版本与系统匹配
   - 检查COM口是否被其他程序占用
   - 重新配置虚拟串口对

6. **仿真调试问题**
   - 使用Proteus的调试功能设置断点
   - 检查变量监视窗口
   - 确认仿真速度设置合理

## 开发团队

- **项目名称**: 温湿度/频率监控系统
- **开发语言**: C51, Python
- **开发工具**: Keil uVision 5, PyQt5
- **硬件平台**: AT89C51单片机

---

*最后更新时间: 2025年07月13日* 
